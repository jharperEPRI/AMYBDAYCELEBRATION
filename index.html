
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest"le>üéÅ Birthday Quest ‚Äî 2026</title>
  <style>
    :root { --primary:#007aff; --gray:#6b7280; --green:#10b981; --red:#ef4444; }
    body { font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto; margin:0; color:#111; background:#fff; }
    header { padding:1rem; text-align:center; border-bottom:1px solid #eee; }
    header h1 { margin:.2rem 0; }
    header p { color:var(--gray); margin:.2rem 0 .6rem; }
    .progress { width:90%; max-width:680px; margin:.5rem auto 1rem; background:#f4f4f5; border-radius:999px; overflow:hidden; height:10px; }
    .bar { height:100%; background:linear-gradient(90deg, var(--primary), #34d399); width:0%; transition:width .4s; }
    main { max-width:820px; margin:0 auto; padding:1rem; }
    .day { margin:1rem 0; padding:.5rem 0; }
    .card { border:1px solid #e5e7eb; border-radius:14px; padding:1rem; margin:.8rem 0; box-shadow:0 1px 2px rgba(0,0,0,.04); }
    .locked { opacity:.75; }
    .meta { font-size:.9rem; color:var(--gray); margin:.4rem 0; }
    .btn { background:var(--primary); color:#fff; border:none; border-radius:12px; padding:.6rem 1rem; font-weight:600; cursor:pointer; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
    .task { display:flex; align-items:center; gap:.5rem; margin:.25rem 0; }
    .task input { width:18px; height:18px; }
    .result { margin:.5rem 0; }
    .success { color:var(--green); font-weight:600; }
    .warn { color:var(--red); }
    .hint { color:var(--gray); font-style:italic; }
    .photo { width:100%; max-width:360px; margin:.4rem 0; border-radius:12px; }
    footer { text-align:center; color:var(--gray); padding:2rem 1rem; }
  </style>
</head>
<body>
<header>
  <h1>üéâ Birthday Quest ‚Äî Jan 10‚Äì11, 2026</h1>
  <p>Clues, little challenges, and photos at each stop. Unlocks by location (and time where noted).</p>
  <div class="progress"><div class="bar" id="bar"></div></div>
  <p class="hint">Tip: In Safari, tap <b>Share</b> ‚Üí <b>Add to Home Screen</b> for the full‚Äëscreen app experience.</p>
</header>

<main id="content"></main>

<footer>
  <p>Made with ‚ù§Ô∏è by Jim & family</p>
</footer>

<script>
// ====== CONFIG: itinerary stops ======
const stops = [
  // --- Day 1: Saturday, Jan 10, 2026 ---
  {
    id:"villagegrind",
    day:"2026-01-10",
    name:"The Village Grind ‚Äî Coffee Kickoff",
    lat:null, lon:null, // TODO: paste precise coords (e.g., 34.85..., -82.41...)
    radius_m:120,
    when:{ start:"2026-01-10T08:00:00-05:00", end:"2026-01-10T12:00:00-05:00" }, // generous window
    riddle:"Where the latte art is legendary and friendship fuels the roast. Find the co-owner‚Äôs touch in the syrups.",
    maps:"https://maps.apple.com/?q=The%20Village%20Grind",
    tasks:[
      "Order her favorite (or a new seasonal latte).",
      "Spot a mural or art piece nearby and snap a photo.",
      "Toast to the day‚Äîcheers selfie!"
    ]
  },
  {
    id:"morninggoat",
    day:"2026-01-10",
    name:"The Morning Goat ‚Äî Brunch/Lunch",
    lat:null, lon:null, radius_m:150, // TODO: coords
    when:{ start:"2026-01-10T10:00:00-05:00", end:"2026-01-10T14:00:00-05:00" },
    riddle:"Hoof it to brunch‚Äîwhere the vibe is bright and the plates are hearty.",
    maps:"https://maps.apple.com/?q=The%20Morning%20Goat",
    tasks:[
      "Family table photo (no phones in the shot üòÑ).",
      "Find ‚Äògoat‚Äô somewhere (menu, art, merch) and snap it.",
      "Pick a shared dish and rate it 1‚Äì5."
    ]
  },
  {
    id:"paintingtwist",
    day:"2026-01-10",
    name:"Painting with a Twist ‚Äî Canvas Session (1‚Äì3 PM)",
    lat:null, lon:null, radius_m:120, // TODO: coords
    when:{ start:"2026-01-10T12:50:00-05:00", end:"2026-01-10T15:10:00-05:00" }, // time-gated
    riddle:"Brushes up! Create four canvases that link‚Äîbonus points if they form one scene.",
    maps:"https://maps.apple.com/?q=Painting%20With%20a%20Twist",
    tasks:[
      "Group selfie with aprons on.",
      "Each person hides a tiny heart somewhere in their painting.",
      "Photo of the four canvases side-by-side."
    ]
  },
  {
    id:"swamprabbitcafe",
    day:"2026-01-10",
    name:"Swamp Rabbit Caf√© ‚Äî Snack & Trail",
    lat:null, lon:null, radius_m:160, // TODO: coords
    when:{ start:"2026-01-10T15:00:00-05:00", end:"2026-01-10T17:40:00-05:00" },
    riddle:"Fuel up and follow the bunny. Choose a direction and find three ‚Äòtrail tokens.‚Äô",
    maps:"https://maps.apple.com/?q=Swamp%20Rabbit%20Cafe%20and%20Grocery",
    tasks:[
      "Grab drinks/snacks‚Äîphoto with the rabbit logo.",
      "Trail tokens: a bike bell, a bridge/trestle, a park sign (photos).",
      "High‚Äëfive line while walking the trail."
    ]
  },
  {
    id:"hollowedearth",
    day:"2026-01-10",
    name:"Hollowed Earth Pottery ‚Äî Mug Making (6‚Äì7:30 PM)",
    lat:null, lon:null, radius_m:120, // TODO: coords
    when:{ start:"2026-01-10T17:45:00-05:00", end:"2026-01-10T19:45:00-05:00" }, // time-gated
    riddle:"Center the clay, steady the hands. Choose your glaze style‚Äîclassic, speckled, or bold.",
    maps:"https://maps.apple.com/?q=Hollowed%20Earth%20Pottery",
    tasks:[
      "Wheel action shot for each person.",
      "Pick glaze colors‚Äîphoto of each choice.",
      "Group photo holding the freshly thrown mugs."
    ]
  },
  {
    id:"trio",
    day:"2026-01-10",
    name:"Trio ‚Äî Family Favorite Dinner",
    lat:null, lon:null, radius_m:150, // TODO: coords
    when:{ start:"2026-01-10T19:30:00-05:00", end:"2026-01-10T22:30:00-05:00" },
    riddle:"A classic to close the night‚Äîshare bites, stories, and a birthday toast.",
    maps:"https://maps.apple.com/?q=Trio%20A%20Brick%20Oven%20Cafe",
    tasks:[
      "Table toast photo (glasses up).",
      "Each person shares one favorite moment from the day (record a 10‚Äì20s video if you like).",
      "Capture dessert (or the last slice) for posterity."
    ]
  },
  // --- Day 2: Sunday, Jan 11, 2026 ---
  {
    id:"humane",
    day:"2026-01-11",
    name:"Greenville Humane Society ‚Äî Dog Walk (10:30 AM)",
    lat:null, lon:null, radius_m:150, // TODO: coords
    when:{ start:"2026-01-11T10:00:00-05:00", end:"2026-01-11T12:00:00-05:00" },
    riddle:"New furry friend, new memory. Walk, wag, repeat.",
    maps:"https://maps.apple.com/?q=Greenville%20Humane%20Society",
    tasks:[
      "Photo with your assigned pup & name tag.",
      "Short video (5‚Äì10s) of the dog‚Äôs happy trot.",
      "Group selfie + ‚Äòthank you‚Äô message to the shelter."
    ]
  }
];

// ====== storage helpers ======
const store = {
  key:'quest2026',
  read(){ try{ return JSON.parse(localStorage.getItem(this.key))||{}; }catch(e){ return {}; } },
  write(d){ localStorage.setItem(this.key, JSON.stringify(d)); }
};

// ====== utility ======
const fmt = (iso) => new Date(iso).toLocaleString([], { dateStyle:'medium', timeStyle:'short' });

function distanceMeters(a, b) {
  const toRad = deg => deg * Math.PI/180;
  const R = 6371000;
  const dLat = toRad(b.lat - a.lat);
  const dLon = toRad(b.lon - a.lon);
  const lat1 = toRad(a.lat), lat2 = toRad(b.lat);
  const h = Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)**2;
  return 2 * R * Math.asin(Math.sqrt(h));
}

function withinTimeWindow(win) {
  if(!win) return true;
  const now = new Date();
  const start = new Date(win.start);
  const end = new Date(win.end);
  return now >= start && now <= end;
}

// ====== rendering ======
function render() {
  const data = store.read();
  const content = document.getElementById('content');
  content.innerHTML = '';

  const byDay = {};
  stops.forEach(s => { (byDay[s.day] ||= []).push(s); });

  let total = stops.length;
  let done = Object.values(data).filter(v => v?.unlocked).length;
  document.getElementById('bar').style.width = Math.round(done/total*100) + '%';

  Object.keys(byDay).sort().forEach(day => {
    const dayWrap = document.createElement('div'); dayWrap.className = 'day';
    const dayTitle = new Date(day).toLocaleDateString([], { weekday:'long', year:'numeric', month:'short', day:'numeric' });
    dayWrap.innerHTML = `<h2>üìÖ ${dayTitle}</h2>`;
    byDay[day].forEach(s => {
      const entry = document.createElement('div'); entry.className = 'card';
      const status = data[s.id]?.unlocked ? 'Unlocked!' : 'Locked';
      const timed = s.when ? `Time window: ${fmt(s.when.start)} ‚Äì ${fmt(s.when.end)}` : '';
      entry.innerHTML = `
        <h3>${s.name}</h3>
        <p>${s.riddle}</p>
        <p class="meta">${timed} ${timed ? ' ‚Ä¢ ' : ''}<a href="${s.maps}" target/p>
        <div class="tasks"></div>
        <div class="controls">
          <button class="btn checkBtn">Check Location</button>
          <button class="btn photoBtn" style="background:#6d28d9">Add Photo</button>
        </div>
        <div class="result"></div>
        <img class="photo" style="display:none"/>
        <input class="file" type="file" accept="image/*" capture="environment" style="display:none"/>
      `;
      const tasksEl = entry.querySelector('.tasks');
      s.tasks.forEach((t, i) => {
        const row = document.createElement('div'); row.className = 'task';
        const cb = document.createElement('input'); cb.type='checkbox';
        cb.checked = !!data[s.id]?.tasks?.[i];
        cb.addEventListener('change', () => {
          const d = store.read(); d[s.id] = d[s.id] || {};
          (d[s.id].tasks ||= [])[i] = cb.checked; store.write(d);
        });
        const label = document.createElement('label'); label.textContent = t;
        row.appendChild(cb); row.appendChild(label); tasksEl.appendChild(row);
      });

      const result = entry.querySelector('.result');
      const btn = entry.querySelector('.checkBtn');
      const file = entry.querySelector('.file');
      const img = entry.querySelector('.photo');
      const photoBtn = entry.querySelector('.photoBtn');

      // Check location & time
      btn.addEventListener('click', () => {
        if (!('geolocation' in navigator)) { result.innerHTML = `<p class="warn">Geolocation unavailable.</p>`; return; }
        if (s.lat == null || s.lon == null) { result.innerHTML = `<p class="warn">Coordinates not set yet. Paste lat/lon for ${s.name}.</p>`; return; }
        navigator.geolocation.getCurrentPosition(pos => {
          const me = { lat: pos.coords.latitude, lon: pos.coords.longitude };
          const d = Math.round(distanceMeters(me, {lat:s.lat, lon:s.lon}));
          const timeOK = withinTimeWindow(s.when);
          if (!timeOK) {
            result.innerHTML = `<p class="warn">Too early/late. This stop unlocks between <b>${fmt(s.when.start)}</b> and <b>${fmt(s.when.end)}</b>.</p>`;
            return;
          }
          if (d <= s.radius_m) {
            const db = store.read(); db[s.id] = db[s.id] || {};
            db[s.id].unlocked = true; store.write(db);
            result.innerHTML = `<p class="success">Unlocked! (~${d} m). ‚≠ê Complete the tasks & add a photo.</p>`;
            document.getElementById('bar').style.width =
              Math.round(Object.values(store.read()).filter(v=>v?.unlocked).length/total*100)+'%';
            confetti();
          } else {
            result.innerHTML = `<p>Keep going‚Ä¶ you‚Äôre ~${d} m away.</p>`;
          }
        }, err => result.textContent = err.message, { enableHighAccuracy:true, timeout:12000 });
      });

      // Photos
      photoBtn.addEventListener('click', () => file.click());
      file.addEventListener('change', () => {
        const f = file.files[0]; if (!f) return;
        img.src = URL.createObjectURL(f);
        img.style.display = 'block';
        const db = store.read(); db[s.id] = db[s.id] || {};
        db[s.id].photo = db[s.id].photo || []; db[s.id].photo.push({ name:f.name, ts:Date.now() });
        store.write(db);
        result.innerHTML = `<p>Photo added. üì∏</p>`;
      });

      // Locked visual
      if (!data[s.id]?.unlocked) entry.classList.add('locked'); else entry.classList.remove('locked');
      content.appendChild(entry);
    });
    content.appendChild(dayWrap);
  });
}

// Tiny confetti (CSS-free)
function confetti(){
  for(let i=0;i<18;i++){
    const d=document.createElement('div');
    d.textContent='üéä'; d.style.position='fixed'; d.style.left=Math.random()*100+'%';
    d.style.top='-20px'; d.style.fontSize='20px'; d.style.transition='transform 1.2s ease, opacity 1.2s';
    document.body.appendChild(d);
    setTimeout(()=>{ d.style.transform=`translateY(${80+Math.random()*70}vh)`; d.style.opacity='0'; }, 10);
    setTimeout(()=> d.remove(), 1400);
  }
}

render();

// Service worker
if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
</script>
</body>
</html>
